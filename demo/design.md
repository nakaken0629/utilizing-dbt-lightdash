# demo

これはデモデータを作るためのツールの設計書です。

## 用語

- 退会会員
  - 今後二度とログインや購入をしない
  - ある会員が退会するかどうかは、会員属性のis_quit_daysに値が入っているかどうかで判断する
  - ある会員が退会したかどうかは、会員のステータスが「退会会員」になったかどうかがで判断する。
- 休眠会員
  - 退会はしていないけど、今後二度とログインや購入をしない会員
  - ある会員が休眠するかどうかは、会員属性のis_sleep_daysに値が入っているかどうかで判断する
  - ある会員が休眠したかどうかは、会員の登録日からis_sleep_daysの日数が経ったかどうかで判断する。
- 有料会員
  - 通常会員より頻繁にログインして、たくさん購入する会員
  - ある会員が有料会員になるかどうかは、会員属性のis_paid_daysに値が入っているかどうかで判断する
  - ある会員が有料会員かどうかは、会員のステータスが「有料会員」かどうかで判断する。  
- 通常会員
  - 上記以外の会員

## データベースの仕様

- データベースサーバーは、docker-compose.ymlで定義されているdemo-dbコンテナ
- データベースは"demo-db"
- スキーマは、デフォルトで作成される"PUBLIC"
- ユーザーは"demo-user"。PUBLICスキーマに対する全ての権限を有する

## テーブルの仕様

テーブルの仕様は、models.pyで行う

## ツールの仕様

- 言語はPythonを利用する。
- パッケージマネージャとしてuvを利用する
- テストデータを作成するライブラリとして、mimesisを利用する
  - https://mimesis.name/master/

### 初期化ツール

1. 新たにデータベースを作成する（すでにデータベースがある場合は削除する）
2. テーブルを作成する

### テストデータ生成ツール

1. テストデータ作成開始日時を入力させる（初期値は今日より5日前）
2. マスタデータを作成する
2.1. categoryテーブルには、mimesis の Food プロバイダーで用意されているgenerate用のメソッド名(例：dish, drink, その他）を日本語にして一つずつ保存する
2.2. foodテーブルは、1000件作成する
3. 1日ごとに以下の処理を実行する
3.1. 開始後１０日間は、50〜100人のランダム値、それ以降は0人〜3人の乱数値か、年30%〜70%の増加数になるための一日あたりの利率を会員数にかけて切り捨て値の、どちら多い人数分だけ、memberデータとmember_propertyデータを作成する
3.2. 会員のステータスを変更する
3.2.1. is_paid_dtがnullの会員が、会員登録を行ってから会員属性のto_paid_daysの日数を過ぎていたら、有料会員になる。
3.2.2. is_quit_dtがnullの会員が、会員登録を行ってから会員属性のto_quit_daysの日数を過ぎていたら、退会する。
3.3. 通常会員について、以下の処理を行う
3.3.1.　全体の20%の会員が、処理日の任意の時間にログインする
3.3.2. ログインしたユーザーのうち、30%のユーザーが、2000円〜10000円の範囲で購入処理を行う
3.4. 有料会員について、以下の処理を行う
3.4.1.　全体の50%の会員が、処理日の任意の時間にログインする
3.4.2. ログインしたユーザーのうち、50%のユーザーが、5000円〜20000円の範囲で購入処理を行う
