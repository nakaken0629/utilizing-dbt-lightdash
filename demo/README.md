# demo

デモ用データベース（`demo-db`）を構築・サンプルデータを生成するためのツールです。

## 概要

食品ECサイトをテーマに、会員の登録・有料化・退会といったライフサイクルをシミュレーションしながら、リアルなサンプルデータを生成します。生成されたデータは `seeds_loader/` を通じてDWHに転送され、dbtモデルの入力となります。

## ツール構成

| ファイル | 説明 |
|---|---|
| `init.py` | データベース・テーブルを初期化する |
| `seed.py` | サンプルデータを生成・投入する |
| `psql.sh` | demo-db に psql で接続するスクリプト |
| `models.md` | テーブル設計書（列定義・制約・データ投入ルール） |
| `design.md` | ツール仕様書（データ生成ロジックの詳細） |

## テーブル構成

| テーブル | 説明 |
|---|---|
| `member` | 会員マスタ |
| `member_property` | 会員属性（行動シミュレーション用パラメータ） |
| `category` | 食品カテゴリマスタ |
| `food` | 食品マスタ |
| `purchase` | 購入ヘッダ |
| `purchase_detail` | 購入明細 |
| `member_status_log` | 会員ステータス変更履歴 |

## 前提条件

- `docker-compose.yml` の `demo-db` コンテナが起動していること
- プロジェクトルートに `.env.local` ファイルが存在すること（`.env.local.example` を参照）

## 使い方

### 1. 初期化

データベースとテーブルを作成します。すでに `demo-db` データベースが存在する場合は削除して再作成します。

```bash
uv run python demo/init.py
```

### 2. サンプルデータ生成

会員・食品・購入データを日付ごとにシミュレーションして生成します。

```bash
uv run python demo/seed.py
```

実行時に開始日時の入力を求められます（デフォルト: 実行日の5日前）。

### 3. psql接続

```bash
bash demo/psql.sh
```

## データ生成ロジックの概要

1. カテゴリ・食品マスタを生成（food 1,000件）
2. 開始日から1日ずつ以下を繰り返す:
   - 会員を新規追加（最初の10日間: 50〜100人/日、以降: 緩やかな増加）
   - 会員ステータスを更新（有料化・退会）
   - 通常会員の購入シミュレーション（ログイン率20%、購入率30%、購入額2,000〜10,000円）
   - 有料会員の購入シミュレーション（ログイン率50%、購入率50%、購入額5,000〜20,000円）

詳細は `design.md` および `models.md` を参照してください。
